<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.56.3" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>TLS setup :: nray</title>

    
    <link href="/css/nucleus.css?1565802998" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1565802998" rel="stylesheet">
    <link href="/css/hybrid.css?1565802998" rel="stylesheet">
    <link href="/css/featherlight.min.css?1565802998" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1565802998" rel="stylesheet">
    <link href="/css/auto-complete.css?1565802998" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1565802998" rel="stylesheet">
    <link href="/css/theme.css?1565802998" rel="stylesheet">
    <link href="/css/hugo-theme.css?1565802998" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1565802998" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1565802998"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/usage/tls-setup/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1565802998"></script>
<script type="text/javascript" src="/js/auto-complete.js?1565802998"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/nray-scanner.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1565802998"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/introduction/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/introduction/">
          <b>1. </b>Introduction
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/installation/" title="Installation" class="dd-item 
        
        
        
        ">
      <a href="/installation/">
          <b>2. </b>Installation
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/installation/prebuilt/" title="Prebuilt Binaries" class="dd-item ">
        <a href="/installation/prebuilt/">
        Prebuilt Binaries
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/installation/build-your-own/" title="Build Your Own" class="dd-item ">
        <a href="/installation/build-your-own/">
        Build Your Own
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/usage/" title="Usage" class="dd-item 
        parent
        
        
        ">
      <a href="/usage/">
          <b>3. </b>Usage
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/usage/configuration-file/" title="Configuration file (server)" class="dd-item 
        
        
        
        ">
      <a href="/usage/configuration-file/">
          <b>3.1 </b>Configuration file (server)
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/basic-settings/" title="Basic settings" class="dd-item ">
        <a href="/usage/configuration-file/basic-settings/">
        <b>3.1.1 </b>Basic settings
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/tls/" title="TLS" class="dd-item ">
        <a href="/usage/configuration-file/tls/">
        <b>3.1.2 </b>TLS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/internal/" title="Internal" class="dd-item ">
        <a href="/usage/configuration-file/internal/">
        <b>3.1.3 </b>Internal
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/configuration-file/targetgenerator/" title="targetgenerator" class="dd-item 
        
        
        
        ">
      <a href="/usage/configuration-file/targetgenerator/">
          <b>3.1.4.0 </b>targetgenerator
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/targetgenerator/standard/" title="standard" class="dd-item ">
        <a href="/usage/configuration-file/targetgenerator/standard/">
        <b>3.1.4.1 </b>standard
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/targetgenerator/certificatetransparency/" title="certificatetransparency" class="dd-item ">
        <a href="/usage/configuration-file/targetgenerator/certificatetransparency/">
        <b>3.1.4.2 </b>certificatetransparency
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/targetgenerator/ldap/" title="ldap" class="dd-item ">
        <a href="/usage/configuration-file/targetgenerator/ldap/">
        <b>3.1.4.3 </b>ldap
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/configuration-file/scannerconfig/" title="scannerconfig" class="dd-item 
        
        
        
        ">
      <a href="/usage/configuration-file/scannerconfig/">
          <b>3.1.5.0 </b>scannerconfig
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/scannerconfig/tcp/" title="tcp" class="dd-item ">
        <a href="/usage/configuration-file/scannerconfig/tcp/">
        <b>3.1.5.1 </b>tcp
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/scannerconfig/udp/" title="udp" class="dd-item ">
        <a href="/usage/configuration-file/scannerconfig/udp/">
        <b>3.1.5.2 </b>udp
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/configuration-file/scannerconfig/zgrab2/" title="zgrab2" class="dd-item 
        
        
        
        ">
      <a href="/usage/configuration-file/scannerconfig/zgrab2/">
          <b>3.1.5.3 </b>zgrab2
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/scannerconfig/zgrab2/ssh/" title="ssh" class="dd-item ">
        <a href="/usage/configuration-file/scannerconfig/zgrab2/ssh/">
        <b>3.1.5.3.1 </b>ssh
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/scannerconfig/zgrab2/http/" title="http" class="dd-item ">
        <a href="/usage/configuration-file/scannerconfig/zgrab2/http/">
        <b>3.1.5.3.2 </b>http
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/configuration-file/events/" title="events" class="dd-item 
        
        
        
        ">
      <a href="/usage/configuration-file/events/">
          <b>3.1.6.0 </b>events
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/events/terminal/" title="terminal" class="dd-item ">
        <a href="/usage/configuration-file/events/terminal/">
        <b>3.1.6.1 </b>terminal
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/events/json-file/" title="json-file" class="dd-item ">
        <a href="/usage/configuration-file/events/json-file/">
        <b>3.1.6.2 </b>json-file
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/configuration-file/events/elasticsearch/" title="elasticsearch" class="dd-item ">
        <a href="/usage/configuration-file/events/elasticsearch/">
        <b>3.1.6.3 </b>elasticsearch
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/flags/" title="Command line flags (node)" class="dd-item ">
        <a href="/usage/flags/">
        <b>3.2 </b>Command line flags (node)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/pooling/" title="Pooling" class="dd-item ">
        <a href="/usage/pooling/">
        <b>3.3 </b>Pooling
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/tls-setup/" title="TLS setup" class="dd-item active">
        <a href="/usage/tls-setup/">
        <b>3.4 </b>TLS setup
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/examples/" title="Examples" class="dd-item ">
        <a href="/usage/examples/">
        <b>3.5 </b>Examples
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/contribute/" title="Contribute" class="dd-item 
        
        
        
        ">
      <a href="/contribute/">
          <b>4. </b>Contribute
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p><a href="https://github.com/nray-scanner/nray"><i class="fab fa-github"></i> Github</a></p>
<p><a href="https://twitter.com/michael_eder_"><i class="fab fa-twitter"></i> Twitter</a></p>

<br>

<p>Built with <i class="fas fa-heart"></i>, <i class="fas fa-coffee"></i>  and <i class="fas fa-beer"></i> by <a href="https://michael-eder.net">Michael Eder</a>.</p>

<br>

<p>nray is licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GPLv3</a>.</p>
<p>Homepage and documentation are licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i><i class="fab fa-creative-commons-sa"></i> CC BY-SA 4.0</a>.</p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/nray-scanner/website/edit/master/content/usage/tls-setup.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>nray</a> > <a href='/usage/'>Usage</a> > TLS setup
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#cfssl-generate-local-ca-keys-and-certificates">CFSSL: Generate local CA, keys and certificates</a></li>
<li><a href="#what-you-need-for-operation">What you need for operation</a>
<ul>
<li><a href="#server">Server</a></li>
<li><a href="#node">Node</a></li>
</ul></li>
<li><a href="#howto-run">HowTo run</a>
<ul>
<li><a href="#trust-every-server-no-client-auth">Trust every server, no client auth</a></li>
<li><a href="#trust-only-this-server-no-client-auth">Trust only this server, no client auth</a></li>
<li><a href="#trust-only-this-server-client-authentication">Trust only this server, client authentication</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              TLS setup
            </h1>
          

        





<p>It is recommended to use TLS for protecting traffic between nray&rsquo;s server and nodes, including mutual authentication if required.
This quick start guide describes a portable and working approach to generate a CA and all required keys and certificates as well as how to use them.
The goal is to provide an easy to follow guide, nevertheless a basic understanding of TLS and PKI is recommended.</p>

<p>This guide relies on cloudflare&rsquo;s open source <a href="https://cfssl.org/">cfssl</a>.
Cherry-picked from <a href="https://gist.github.com/denji/12b3a568f092ab951456">here</a> and <a href="https://kb.op5.com/pages/viewpage.action?pageId=19073746">here</a> and <a href="https://github.com/jcbsmpsn/golang-https-example">here</a> and of course <a href="https://github.com/cloudflare/cfssl">here</a>.</p>

<p>If you manage to get this up and running using keys and certificates generated by OpenSSL, Microsoft PKI, vim macro or your favorite solution not listed yet, we would love to know how you did it - simply edit this page and send a pull request!</p>

<h3 id="cfssl-generate-local-ca-keys-and-certificates">CFSSL: Generate local CA, keys and certificates</h3>

<ol>
<li>Get cfssl: <code>go get -u github.com/cloudflare/cfssl/cmd/cfssl</code> and <code>go get -u github.com/cloudflare/cfssl/cmd/cfssljson</code></li>

<li><p>Generate a CSR and save it to a file, e.g. <code>csr.json</code>. It contains basic information about the CA:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">{
<span style="color:#f92672">&#34;key&#34;</span>: {
    <span style="color:#f92672">&#34;algo&#34;</span>: <span style="color:#e6db74">&#34;rsa&#34;</span>,
    <span style="color:#f92672">&#34;size&#34;</span>: <span style="color:#ae81ff">2048</span>
},
<span style="color:#f92672">&#34;names&#34;</span>: [
    {
        <span style="color:#f92672">&#34;C&#34;</span>:  <span style="color:#e6db74">&#34;DE&#34;</span>,
        <span style="color:#f92672">&#34;L&#34;</span>:  <span style="color:#e6db74">&#34;Munich&#34;</span>,
        <span style="color:#f92672">&#34;O&#34;</span>:  <span style="color:#e6db74">&#34;nray-scanner&#34;</span>
    }
]
}</code></pre></div></li>

<li><p>Generate a local CA: <code>cfssl  genkey -initca csr.json | cfssljson -bare ca</code>. This creates <code>ca-key.pem</code>, the CA&rsquo;s private key, as well as <code>ca.pem</code>, the certificate and <code>ca.csr</code> which is of no further use and may be deleted.</p></li>

<li><p>Generate server certificate. If the host where nray is going to run has a DNS name, you may include it here, otherwise keep localhost: <code>cfssl gencert -ca ca.pem -ca-key ca-key.pem -hostname=localhost csr.json | cfssljson -bare server</code>. This creates files analogous to our CA, but with <code>server*</code> in their names.</p></li>

<li><p>(if node auth is desired) Generate node certificate. Analogous to server. You may omit the hostname field and ignore the warning. Repeat for every node or reuse certificate.</p></li>
</ol>

<p>As you do not need the csr&rsquo;s anymore, you may delete them if you want.</p>

<h3 id="what-you-need-for-operation">What you need for operation</h3>

<h4 id="server">Server</h4>

<ul>
<li><code>ca.pem</code> (This is public knowledge btw)</li>
<li><code>server.pem</code> (public if you want)</li>
<li><code>server-key.pem</code> (private)</li>
</ul>

<h4 id="node">Node</h4>

<ul>
<li><code>ca.pem</code> (This is public knowledge btw)</li>
<li><code>client.pem</code> (public if you want)</li>
<li><code>client-key.pem</code> (private)</li>
</ul>

<h3 id="howto-run">HowTo run</h3>

<h4 id="trust-every-server-no-client-auth">Trust every server, no client auth</h4>

<ul>
<li>Server: Set <code>TLS.enabled: true</code>, <code>TLS.CA: &quot;/path/to/your/ca.pem&quot;</code>, <code>TLS.cert: /path/to/your/server.pem</code>, and <code>TLS.key: /path/to/your/server-key.pem</code></li>
<li>Node: <code>./nray node -s &lt;ip-or-dnsname&gt; -p 8601 --use-tls --tls-insecure</code>. <strong>This is insecure and traffic may be intercepted/modified by a 3rd party!</strong>. This mode of operation only protects from somebody occasionally scrolling over the traffic in Wireshark.</li>
</ul>

<h4 id="trust-only-this-server-no-client-auth">Trust only this server, no client auth</h4>

<ul>
<li>Server: Set <code>TLS.enabled: true</code>, <code>TLS.CA: &quot;/path/to/your/ca.pem&quot;</code>, <code>TLS.cert: /path/to/your/server.pem</code>, and <code>TLS.key: /path/to/your/server-key.pem</code></li>
<li>Node: <code>./nray node -s &lt;ip-or-dnsname&gt; -p 8601 --use-tls --tls-ca-cert /path/to/your/ca.pem --tls-server-SAN &quot;&lt;hostname&gt;&quot;</code>. If the nray-server has actually a DNS name that is also reflected in the cert, you can omit <code>--tls-server-SAN</code>, but if you are in an ad-hoc scenario or there is no DNS available and nray complains that the server name is missing, <code>--tls-server-SAN</code> is your friend.</li>
</ul>

<h4 id="trust-only-this-server-client-authentication">Trust only this server, client authentication</h4>

<ul>
<li>Server: Set <code>TLS.enabled: true</code>, <code>TLS.CA: &quot;/path/to/your/ca.pem&quot;</code>, <code>TLS.cert: /path/to/your/server.pem</code>, and <code>TLS.key: /path/to/your/server-key.pem</code></li>
<li>Node: <code>./nray-node -s &lt;ip-or-dnsname&gt; -p 8601 --use-tls --tls-ca-cert /path/to/your/ca.pem --tls-server-SAN &quot;&lt;hostname&gt;&quot; --tls-client-cert /path/to/your/client.pem --tls-client-key /path/to/your/client-key.pem</code>. If the nray-server has actually a DNS name that is also reflected in the cert, you can omit <code>--tls-server-SAN</code>, but if you are in an ad-hoc scenario or there is no DNS available and nray complains that the server name is missing, <code>--tls-server-SAN</code> is your friend.</li>
</ul>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/usage/pooling/" title="Pooling"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/usage/examples/" title="Examples" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1565802998"></script>
    <script src="/js/perfect-scrollbar.min.js?1565802998"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1565802998"></script>
    <script src="/js/jquery.sticky.js?1565802998"></script>
    <script src="/js/featherlight.min.js?1565802998"></script>
    <script src="/js/html5shiv-printshiv.min.js?1565802998"></script>
    <script src="/js/highlight.pack.js?1565802998"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1565802998"></script>
    <script src="/js/learn.js?1565802998"></script>
    <script src="/js/hugo-learn.js?1565802998"></script>

    <link href="/mermaid/mermaid.css?1565802998" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1565802998"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

